<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="KVM配置虚拟机"><meta name="keywords" content="Linux,KVM"><meta name="author" content="小白long,undefined"><meta name="copyright" content="小白long"><title>KVM配置虚拟机【藏经阁】</title><link rel="stylesheet" href="/css/fan.css"><link rel="stylesheet" href="/css/thirdparty/jquery.mCustomScrollbar.min.css"><link rel="icon" href="/favicon.ico"><script>var isPassword = '' || false;
if (isPassword) {
    if (prompt('请输入文章密码') !== '') {
        alert('密码错误！');
        history.back();
    }
}</script><script>window.GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
}</script></head><body><canvas id="universe"></canvas><!--#body--><div id="sidebar"><div class="toggle-sidebar-info button-hover"><span data-toggle="文章目录">站点概览</span></div><div class="sidebar-toc"><div class="sidebar-toc-title">目录</div><div class="sidebar-toc-progress"><span class="progress-notice">您已阅读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc-progress-bar"></div></div><div class="sidebar-toc-content" id="sidebar-toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#KVM简介："><span class="toc-number">1.</span> <span class="toc-text">KVM简介：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#开源软件，全称是kernel-based-virtual-machine（基于内核的虚拟机）。"><span class="toc-number">1.0.1.</span> <span class="toc-text">开源软件，全称是kernel-based virtual machine（基于内核的虚拟机）。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#是x86架构且硬件支持虚拟化技术（如-intel-VT-或-AMD-V）的Linux全虚拟化解决方案。"><span class="toc-number">1.0.2.</span> <span class="toc-text">是x86架构且硬件支持虚拟化技术（如 intel VT 或 AMD-V）的Linux全虚拟化解决方案。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#它包含一个为处理器提供底层虚拟化-可加载的核心模块kvm-ko（kvm-intel-ko或kvm-AMD-ko）。"><span class="toc-number">1.0.3.</span> <span class="toc-text">它包含一个为处理器提供底层虚拟化 可加载的核心模块kvm.ko（kvm-intel.ko或kvm-AMD.ko）。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#KVM还需要一个经过修改的QEMU软件（qemu-kvm），作为虚拟机上层控制和界面。"><span class="toc-number">1.0.4.</span> <span class="toc-text">KVM还需要一个经过修改的QEMU软件（qemu-kvm），作为虚拟机上层控制和界面。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#KVM能在不改变linux或windows镜像的情况下同时运行多个虚拟机，（它的意思是多个虚拟机使用同一镜像）并为每一个虚拟机配置个性化硬件环境（网卡、磁盘、图形适配器……）。"><span class="toc-number">1.0.5.</span> <span class="toc-text">KVM能在不改变linux或windows镜像的情况下同时运行多个虚拟机，（它的意思是多个虚拟机使用同一镜像）并为每一个虚拟机配置个性化硬件环境（网卡、磁盘、图形适配器……）。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#在主流的Linux内核，如2-6-20以上的内核均已包含了KVM核心。"><span class="toc-number">1.0.6.</span> <span class="toc-text">在主流的Linux内核，如2.6.20以上的内核均已包含了KVM核心。</span></a></li></ol></li></ol><li class="toc-item toc-level-3"><a class="toc-link" href="#实验步骤"><span class="toc-number">2.</span> <span class="toc-text">实验步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#关闭selinux，将文件中的enforcing改为disables"><span class="toc-number">2.1.</span> <span class="toc-text">关闭selinux，将文件中的enforcing改为disables</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#安装kvm环境"><span class="toc-number">2.2.</span> <span class="toc-text">安装kvm环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看kvm模块是否被加载"><span class="toc-number">2.3.</span> <span class="toc-text">查看kvm模块是否被加载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#开启kvm服务并设置开机启动"><span class="toc-number">2.4.</span> <span class="toc-text">开启kvm服务并设置开机启动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#安装kvm虚拟机"><span class="toc-number">2.5.</span> <span class="toc-text">安装kvm虚拟机</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置宿主机网络"><span class="toc-number">2.6.</span> <span class="toc-text">配置宿主机网络</span></a></li></ol></li></div></div><div class="author-info hide"><div class="author-info-avatar"><img class="author-info-avatar-img" src="/avatar.png"></div><div class="author-info-name">小白long</div><div class="author-info-description"></div><div class="links-buttons"><a class="links-button button-hover" href="https://github.com/mmxlong/mmxlong.github.io" target="_blank">GitHub<i class="icon-dot bg-color5"></i></a><a class="links-button button-hover" href="mailto:1835872473@qq.com" target="_blank">E-Mail<i class="icon-dot bg-color6"></i></a><a class="links-button button-hover" href="tencent://message/?uin=1019593584&amp;Site=&amp;Menu=yes" target="_blank">QQ<i class="icon-dot bg-color4"></i></a></div><div class="author-info-articles"><a class="author-info-articles-archives article-meta" href="/archives"><span class="pull-top">日志</span><span class="pull-bottom">27</span></a><a class="author-info-articles-tags article-meta" href="/tags"><span class="pull-top">标签</span><span class="pull-bottom">26</span></a><a class="author-info-articles-categories article-meta" href="/categories"><span class="pull-top">分类</span><span class="pull-bottom">2</span></a></div></div></div><div id="main-container"><header><div id="menu-outer"><i class="menu-list-icon fas fa-bars"></i><nav id="menu-inner"><a class="menu-item" href="/">首页</a><a class="menu-item" href="/tags">标签</a><a class="menu-item" href="/categories">分类</a><a class="menu-item" href="/archives">归档</a><a class="menu-item" href="/about">关于</a></nav><div class="right-info"><a class="title-name" href="/">藏经阁</a><span id="now-time"></span></div></div></header><div id="content-outer"><div id="content-inner"><article id="post"><div class="post-header"><div class="title">KVM配置虚拟机</div><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 发表于 2019-04-20 | 更新于 2019-04-20</time><!--time.button-hover.post-date #[i.fas.fa-calendar-alt.article-icon(aria-hidden="true")] #[=__('post.modified')] #[=date(page['updated'], config.date_format)]--><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/Linux服务部署/">Linux服务部署</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/Linux/">Linux</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/KVM/">KVM</a></div></div></div><div class="main-content"><h3 id="KVM简介："><a href="#KVM简介：" class="headerlink" title="KVM简介："></a>KVM简介：</h3><h5 id="开源软件，全称是kernel-based-virtual-machine（基于内核的虚拟机）。"><a href="#开源软件，全称是kernel-based-virtual-machine（基于内核的虚拟机）。" class="headerlink" title="开源软件，全称是kernel-based virtual machine（基于内核的虚拟机）。"></a>开源软件，全称是kernel-based virtual machine（基于内核的虚拟机）。</h5><h5 id="是x86架构且硬件支持虚拟化技术（如-intel-VT-或-AMD-V）的Linux全虚拟化解决方案。"><a href="#是x86架构且硬件支持虚拟化技术（如-intel-VT-或-AMD-V）的Linux全虚拟化解决方案。" class="headerlink" title="是x86架构且硬件支持虚拟化技术（如 intel VT 或 AMD-V）的Linux全虚拟化解决方案。"></a>是x86架构且硬件支持虚拟化技术（如 intel VT 或 AMD-V）的Linux全虚拟化解决方案。</h5><h5 id="它包含一个为处理器提供底层虚拟化-可加载的核心模块kvm-ko（kvm-intel-ko或kvm-AMD-ko）。"><a href="#它包含一个为处理器提供底层虚拟化-可加载的核心模块kvm-ko（kvm-intel-ko或kvm-AMD-ko）。" class="headerlink" title="它包含一个为处理器提供底层虚拟化 可加载的核心模块kvm.ko（kvm-intel.ko或kvm-AMD.ko）。"></a>它包含一个为处理器提供底层虚拟化 可加载的核心模块kvm.ko（kvm-intel.ko或kvm-AMD.ko）。</h5><a id="more"></a>
<h5 id="KVM还需要一个经过修改的QEMU软件（qemu-kvm），作为虚拟机上层控制和界面。"><a href="#KVM还需要一个经过修改的QEMU软件（qemu-kvm），作为虚拟机上层控制和界面。" class="headerlink" title="KVM还需要一个经过修改的QEMU软件（qemu-kvm），作为虚拟机上层控制和界面。"></a>KVM还需要一个经过修改的QEMU软件（qemu-kvm），作为虚拟机上层控制和界面。</h5><h5 id="KVM能在不改变linux或windows镜像的情况下同时运行多个虚拟机，（它的意思是多个虚拟机使用同一镜像）并为每一个虚拟机配置个性化硬件环境（网卡、磁盘、图形适配器……）。"><a href="#KVM能在不改变linux或windows镜像的情况下同时运行多个虚拟机，（它的意思是多个虚拟机使用同一镜像）并为每一个虚拟机配置个性化硬件环境（网卡、磁盘、图形适配器……）。" class="headerlink" title="KVM能在不改变linux或windows镜像的情况下同时运行多个虚拟机，（它的意思是多个虚拟机使用同一镜像）并为每一个虚拟机配置个性化硬件环境（网卡、磁盘、图形适配器……）。"></a>KVM能在不改变linux或windows镜像的情况下同时运行多个虚拟机，（它的意思是多个虚拟机使用同一镜像）并为每一个虚拟机配置个性化硬件环境（网卡、磁盘、图形适配器……）。</h5><h5 id="在主流的Linux内核，如2-6-20以上的内核均已包含了KVM核心。"><a href="#在主流的Linux内核，如2-6-20以上的内核均已包含了KVM核心。" class="headerlink" title="在主流的Linux内核，如2.6.20以上的内核均已包含了KVM核心。"></a>在主流的Linux内核，如2.6.20以上的内核均已包含了KVM核心。</h5><p><img src="https://s2.ax1x.com/2019/04/20/ECaCcR.png" alt="ECaCcR.png"></p>
<p>KVM 是基于 x86 虚拟化扩展(Intel VT 或者 AMD-V) 技术的虚拟机软件，所以查看 CPU 是否支持 VT 技术，就可以判断是否支持KVM。有返回结果，如果结果中有vmx（Intel）或svm(AMD)字样，就说明CPU的支持的<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># cat /proc/cpuinfo | egrep 'vmx|svm'</span></span><br><span class="line">flags        : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ss syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon nopl xtopology tsc_reliable nonstop_tsc eagerfpu pni pclmulqdq vmx ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm 3dnowprefetch tpr_shadow vnmi ept vpid fsgsbase tsc_adjust bmi1 hle avx2 smep bmi2 invpcid rtm mpx rdseed adx smap clflushopt xsaveopt xsavec arat</span><br></pre></td></tr></table></figure></p>
<h3 id="实验步骤"><a href="#实验步骤" class="headerlink" title="实验步骤"></a>实验步骤</h3><h4 id="关闭selinux，将文件中的enforcing改为disables"><a href="#关闭selinux，将文件中的enforcing改为disables" class="headerlink" title="关闭selinux，将文件中的enforcing改为disables"></a>关闭selinux，将文件中的enforcing改为disables</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># setenforce 0  #暂时生效</span></span><br><span class="line">[root@server ~]<span class="comment"># vim /etc/sysconfig/selinux  #永久生效</span></span><br><span class="line">SELINUX=disables</span><br></pre></td></tr></table></figure>
<h4 id="安装kvm环境"><a href="#安装kvm环境" class="headerlink" title="安装kvm环境"></a>安装kvm环境</h4><p>kvm相关安装包及其作用:<br>qemu-kvm 主要的KVM程序包<br>python-virtinst 创建虚拟机所需要的命令行工具和程序库<br>virt-manager GUI虚拟机管理工具<br>virt-top 虚拟机统计命令<br>virt-viewer GUI连接程序，连接到已配置好的虚拟机<br>libvirt C语言工具包，提供libvirt服务<br>libvirt-client 为虚拟客户机提供的C语言工具包<br>virt-install 基于libvirt服务的虚拟机创建命令<br>bridge-utils 创建和管理桥接设备的工具<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># yum install -y qemu-kvm python-virtinst libvirt libvirt-python virt-manager libguestfs-tools bridge-utils.x86_64 virt-install.noarch python-virtualenv.noarch</span></span><br></pre></td></tr></table></figure></p>
<h4 id="查看kvm模块是否被加载"><a href="#查看kvm模块是否被加载" class="headerlink" title="查看kvm模块是否被加载"></a>查看kvm模块是否被加载</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># lsmod | grep kvm</span></span><br><span class="line">kvm_intel             183621  0</span><br><span class="line">kvm                   586948  1 kvm_intel</span><br><span class="line">irqbypass              13503  1 kvm</span><br></pre></td></tr></table></figure>
<h4 id="开启kvm服务并设置开机启动"><a href="#开启kvm服务并设置开机启动" class="headerlink" title="开启kvm服务并设置开机启动"></a>开启kvm服务并设置开机启动</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># systemctl start libvirtd.service</span></span><br><span class="line">[root@server ~]<span class="comment"># systemctl enable libvirtd.service</span></span><br></pre></td></tr></table></figure>
<h4 id="安装kvm虚拟机"><a href="#安装kvm虚拟机" class="headerlink" title="安装kvm虚拟机"></a>安装kvm虚拟机</h4><p>安装前要检查语言，如果是中文可能会出错<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># cat /etc/locale.conf</span></span><br><span class="line">LANG=<span class="string">"en_US.UTF-8"</span>  <span class="comment">#如果不是英文直接修改该配置文件即可</span></span><br></pre></td></tr></table></figure></p>
<p>创建安装目录和系统镜像的目录<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># mkdir /kvm</span></span><br><span class="line">[root@server ~]<span class="comment"># mkdir /kvm/vms</span></span><br><span class="line">[root@server ~]<span class="comment"># mkdir /kvm/iso</span></span><br></pre></td></tr></table></figure></p>
<p>上传镜像，可以使用rz工具进行上传<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># yum install -y lrzsz</span></span><br><span class="line">[root@server ~]<span class="comment"># ls /kvm/iso/</span></span><br><span class="line">CentOS-7-x86_64-Minimal-1810.iso</span><br></pre></td></tr></table></figure></p>
<p>安装命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># virt-install --virt-type=kvm --name=centos7_01 --vcpus=2 --memory=512 --location=/kvm/iso/CentOS-7-x86_64-Minimal-1810.iso --disk path=/kvm/vms/centos7_01.qcow2,size=5,format=qcow2 --network bridge=virbr0 --graphics none --extra-args='console=ttyS0' --force</span></span><br></pre></td></tr></table></figure></p>
<p>安装时系统配置选择<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">================================================================================</span><br><span class="line">================================================================================</span><br><span class="line">Installation</span><br><span class="line"></span><br><span class="line">1) [x] Language settings                 2) [!] Time settings</span><br><span class="line">        (English (United States))                (Timezone is not <span class="built_in">set</span>.)</span><br><span class="line">3) [!] Installation <span class="built_in">source</span>               4) [!] Software selection</span><br><span class="line">        (Processing...)                          (Processing...)</span><br><span class="line">5) [!] Installation Destination          6) [x] Kdump</span><br><span class="line">        (No disks selected)                      (Kdump is enabled)</span><br><span class="line">7) [ ] Network configuration             8) [!] Root password</span><br><span class="line">        (Not connected)                          (Password is not <span class="built_in">set</span>.)</span><br><span class="line">9) [!] User creation</span><br><span class="line">        (No user will be created)</span><br><span class="line">  Please make your choice from above [<span class="string">'q'</span> to quit | <span class="string">'b'</span> to begin installation |</span><br><span class="line">  <span class="string">'r'</span> to refresh]:</span><br><span class="line"></span><br><span class="line">[anaconda] 1:main* 2:shell  3:<span class="built_in">log</span>  4:storage-lo&gt; Switch tab: Alt+Tab | Help: F1</span><br></pre></td></tr></table></figure></p>
<h4 id="配置宿主机网络"><a href="#配置宿主机网络" class="headerlink" title="配置宿主机网络"></a>配置宿主机网络</h4><p>1.KVM 虚拟机是基于 NAT 的网络配置；<br>2.只有同一宿主机的虚拟键之间可以互相访问，跨宿主机是不能访问；<br>3.虚拟机需要和宿主机配置成桥接模式，以便虚拟机可以在局域网内可见；<br>Bridge模式配置<br>Bridge方式即虚拟网桥的网络连接方式，是客户机和子网里面的机器能够互相通信。可以使虚拟机成为网络中具有独立IP的主机。桥接网络（也叫 物理设备共享）被用作把一个物理设备复制到一台虚拟机。网桥多用作高级设置，特别是主机多个网络接口的情况<br><a href="https://imgchr.com/i/ECaJUS" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/04/20/ECaJUS.png" alt="ECaJUS.png"></a><br>修改宿主主机物理网卡的配置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># cat /etc/sysconfig/network-scripts/ifcfg-ens33</span></span><br><span class="line">TYPE=Ethernet</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">NAME=ens33</span><br><span class="line">UUID=c973dbaf-9d9c-4f0e-bf43-6f3acf25fc5d</span><br><span class="line">DEVICE=ens33</span><br><span class="line">ONBOOT=yes</span><br><span class="line">BRIDGE=<span class="string">"virbr0"</span> <span class="comment">#在指定网桥的名称</span></span><br></pre></td></tr></table></figure></p>
<p>修改宿主机网桥配置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment">#vim /etc/sysconfig/network-scripts/ifcfg-virbr0</span></span><br><span class="line">TYPE=bridge</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">PEFRDNS=yes</span><br><span class="line">PEFRROUTES=yes</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=virbr0    <span class="comment">#设备名称</span></span><br><span class="line">UUID=c973dbaf-9d9c-4f0e-bf43-6f3acf25fc5d</span><br><span class="line">DEVICE=virbr0  </span><br><span class="line">ONBOOT=yes</span><br><span class="line">IPADDR=192.168.42.101</span><br><span class="line">PREFIX=24</span><br><span class="line">GATEWAY=192.168.42.2</span><br><span class="line">DNS1=114.114.114.114</span><br></pre></td></tr></table></figure></p>
<p>两个网卡都修改完之后重启网络，查看网桥的接口对象<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># brctl show</span></span><br><span class="line">bridge name    bridge id        STP enabled    interfaces</span><br><span class="line">virbr0        8000.000c29f54ce4    yes         ens33</span><br><span class="line">                                               virbr0-nic</span><br><span class="line">                                               vnet0</span><br></pre></td></tr></table></figure></p>
<p>进入虚拟机centos7_01测试<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># systemctl restart network #重启网络使其得到ip</span></span><br><span class="line">[root@localhost ~]<span class="comment"># ping 192.168.42.101</span></span><br><span class="line">PING 192.168.42.101 (192.168.42.101) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.42.101: icmp_seq=1 ttl=64 time=1.88 ms</span><br><span class="line">64 bytes from 192.168.42.101: icmp_seq=2 ttl=64 time=0.224 ms</span><br><span class="line">64 bytes from 192.168.42.101: icmp_seq=3 ttl=64 time=0.518 ms</span><br><span class="line">--- 192.168.42.101 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 2004ms</span><br><span class="line">rtt min/avg/max/mdev = 0.224/0.877/1.889/0.725 ms</span><br></pre></td></tr></table></figure></p>
<p>配置宿主机nat转换<br>NAT(Network Address Translation网络地址翻译)，NAT方式是kvm安装后的默认方式。它支持主机与虚拟机的互访，同时也支持虚拟机访问互联网，但不支持外界访问虚拟机<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># virsh net-edit default  #如果要创建或者修改nat网络，先修改default.xml文件，新建nat可参照旧配置即可</span></span><br></pre></td></tr></table></figure></p>
<p>启用新建的nat网络<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># virsh net-define /usr/share/libvirt/networks/management.xml  #management.xml为新建的nat网络</span></span><br><span class="line">[root@server ~]<span class="comment"># virsh net-start management #启动新建的网络</span></span><br><span class="line">[root@server ~]<span class="comment"># virsh net-autostart management  #开机自启动</span></span><br></pre></td></tr></table></figure></p>
</div><div class="post-copyright"><div class="post-copyright-author"><span class="post-copyright-meta">本文作者: </span><span class="post-copyright-info"><a href="mailto:undefined">小白long</a></span></div><div class="post-copyright-type"><span class="post-copyright-meta">本文链接: </span><span class="post-copyright-info"><a href="https://mmxlong.github.io/2019/04/20/KVM配置虚拟机/">https://mmxlong.github.io/2019/04/20/KVM配置虚拟机/</a></span></div><div class="post-copyright-notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://mmxlong.github.io">藏经阁</a>！</span></div></div></article><div id="pagination"><div class="prev-post pull-left"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/2019/04/20/kvm克隆虚拟机/"><i class="fas fa-angle-left">&nbsp;</i><span>kvm克隆虚拟机</span></a></div><div class="next-post pull-right"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/2019/04/20/配置阿里yum源/"><span>配置阿里yum源</span><span>&nbsp;</span><i class="fas fa-angle-right"></i></a></div></div><!--div!= paginator()--></div></div><div class="button-hover" id="return-top"><i class="fas fa-arrow-up" aria-hidden="true"></i></div><footer><div id="footer"><div class="button-hover" id="side-button"><i class="fas fa-arrow-right"></i></div><div class="right-content"><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fas fa-file-o"></i></span><span id="busuanzi_value_page_pv"></span><span></span></div><div class="copyright">&copy;2017 ～ 2019 By 小白long</div></div></div></footer></div><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery-3.3.1.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/velocity.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery.mCustomScrollbar.concat.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/fan.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/canvas_bg.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/utils.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/scroll.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/sidebar.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/copy.js"></script><!--script(src=url)--></body></html>