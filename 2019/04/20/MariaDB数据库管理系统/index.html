<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="MariaDB数据库管理系统"><meta name="keywords" content="Linux,Mariadb"><meta name="author" content="小白long,undefined"><meta name="copyright" content="小白long"><title>MariaDB数据库管理系统【藏经阁】</title><link rel="stylesheet" href="/css/fan.css"><link rel="stylesheet" href="/css/thirdparty/jquery.mCustomScrollbar.min.css"><link rel="icon" href="/favicon.ico"><script>var isPassword = '' || false;
if (isPassword) {
    if (prompt('请输入文章密码') !== '') {
        alert('密码错误！');
        history.back();
    }
}</script><script>window.GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
}</script></head><body><canvas id="universe"></canvas><!--#body--><div id="sidebar"><div class="toggle-sidebar-info button-hover"><span data-toggle="文章目录">站点概览</span></div><div class="sidebar-toc"><div class="sidebar-toc-title">目录</div><div class="sidebar-toc-progress"><span class="progress-notice">您已阅读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc-progress-bar"></div></div><div class="sidebar-toc-content" id="sidebar-toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#实验环境"><span class="toc-number">1.</span> <span class="toc-text">实验环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实验步骤"><span class="toc-number">2.</span> <span class="toc-text">实验步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#安装和初始化mariadb数据库服务"><span class="toc-number">2.1.</span> <span class="toc-text">安装和初始化mariadb数据库服务</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#初始化数据库"><span class="toc-number">3.</span> <span class="toc-text">初始化数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#数据库的备份和恢复"><span class="toc-number">3.1.</span> <span class="toc-text">数据库的备份和恢复</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MySQL数据库字符集设置-有两种方法"><span class="toc-number">3.2.</span> <span class="toc-text">MySQL数据库字符集设置(有两种方法)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#索引："><span class="toc-number">3.3.</span> <span class="toc-text">索引：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mysql慢查询"><span class="toc-number">3.4.</span> <span class="toc-text">mysql慢查询</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#慢查询的参数："><span class="toc-number">4.</span> <span class="toc-text">慢查询的参数：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#开启mysql慢查询日志的方法有两种："><span class="toc-number">4.1.</span> <span class="toc-text">开启mysql慢查询日志的方法有两种：</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info-avatar"><img class="author-info-avatar-img" src="/avatar.png"></div><div class="author-info-name">小白long</div><div class="author-info-description"></div><div class="links-buttons"><a class="links-button button-hover" href="https://github.com/mmxlong/mmxlong.github.io" target="_blank">GitHub<i class="icon-dot bg-color3"></i></a><a class="links-button button-hover" href="mailto:1835872473@qq.com" target="_blank">E-Mail<i class="icon-dot bg-color4"></i></a><a class="links-button button-hover" href="tencent://message/?uin=1019593584&amp;Site=&amp;Menu=yes" target="_blank">QQ<i class="icon-dot bg-color5"></i></a></div><div class="author-info-articles"><a class="author-info-articles-archives article-meta" href="/archives"><span class="pull-top">日志</span><span class="pull-bottom">32</span></a><a class="author-info-articles-tags article-meta" href="/tags"><span class="pull-top">标签</span><span class="pull-bottom">28</span></a><a class="author-info-articles-categories article-meta" href="/categories"><span class="pull-top">分类</span><span class="pull-bottom">2</span></a></div></div></div><div id="main-container"><header><div id="menu-outer"><i class="menu-list-icon fas fa-bars"></i><nav id="menu-inner"><a class="menu-item" href="/">首页</a><a class="menu-item" href="/tags">标签</a><a class="menu-item" href="/categories">分类</a><a class="menu-item" href="/archives">归档</a><a class="menu-item" href="/about">关于</a></nav><div class="right-info"><a class="title-name" href="/">藏经阁</a><span id="now-time"></span></div></div></header><div id="content-outer"><div id="content-inner"><article id="post"><div class="post-header"><div class="title">MariaDB数据库管理系统</div><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 发表于 2019-04-20 | 更新于 2019-04-20</time><!--time.button-hover.post-date #[i.fas.fa-calendar-alt.article-icon(aria-hidden="true")] #[=__('post.modified')] #[=date(page['updated'], config.date_format)]--><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/Linux服务部署/">Linux服务部署</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/Linux/">Linux</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/Mariadb/">Mariadb</a></div></div></div><div class="main-content"><h3 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h3><p>一台Linux主机</p>
<a id="more"></a>
<h3 id="实验步骤"><a href="#实验步骤" class="headerlink" title="实验步骤"></a>实验步骤</h3><h4 id="安装和初始化mariadb数据库服务"><a href="#安装和初始化mariadb数据库服务" class="headerlink" title="安装和初始化mariadb数据库服务"></a>安装和初始化mariadb数据库服务</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># yum install -y mariadb mariadb-server.x86_64</span></span><br><span class="line">[root@server ~]<span class="comment"># systemctl start mariadb.service</span></span><br><span class="line">[root@server ~]<span class="comment"># systemctl enable mariadb.service</span></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/mariadb.service to /usr/lib/systemd/system/mariadb.service.</span><br><span class="line">[root@server ~]<span class="comment"># firewall-cmd --add-port=3306/tcp --permanent</span></span><br><span class="line">success</span><br><span class="line">[root@server ~]<span class="comment"># firewall-cmd --reload</span></span><br><span class="line">success</span><br></pre></td></tr></table></figure>
<h3 id="初始化数据库"><a href="#初始化数据库" class="headerlink" title="初始化数据库"></a>初始化数据库</h3><p>设置root管理员在数据库中的密码值（注意，该密码并非root管理员在系统中的密码，这里的密码值默认应该为空，可直接按回车键）。<br>设置root管理员在数据库中的专有密码。<br>随后删除匿名账户，并使用root管理员从远程登录数据库，以确保数据库上运行的业务的安全性。<br>删除默认的测试数据库，取消测试数据库的一系列访问权限。<br>刷新授权列表，让初始化的设定立即生效。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># mysql_secure_installation</span></span><br><span class="line">NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB</span><br><span class="line">      SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!</span><br><span class="line">In order to <span class="built_in">log</span> into MariaDB to secure it, we<span class="string">'ll need the current</span></span><br><span class="line"><span class="string">password for the root user.  If you'</span>ve just installed MariaDB, and</span><br><span class="line">you haven<span class="string">'t set the root password yet, the password will be blank,</span></span><br><span class="line"><span class="string">so you should just press enter here.</span></span><br><span class="line"><span class="string">Enter current password for root (enter for none):</span></span><br><span class="line"><span class="string">OK, successfully used password, moving on...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Setting the root password ensures that nobody can log into the MariaDB</span></span><br><span class="line"><span class="string">root user without the proper authorisation.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Set root password? [Y/n] y</span></span><br><span class="line"><span class="string">New password:</span></span><br><span class="line"><span class="string">Re-enter new password:</span></span><br><span class="line"><span class="string">Password updated successfully!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Reloading privilege tables..</span></span><br><span class="line"><span class="string">... Success!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">By default, a MariaDB installation has an anonymous user, allowing anyone</span></span><br><span class="line"><span class="string">to log into MariaDB without having to have a user account created for</span></span><br><span class="line"><span class="string">them.  This is intended only for testing, and to make the installation</span></span><br><span class="line"><span class="string">go a bit smoother.  You should remove them before moving into a</span></span><br><span class="line"><span class="string">production environment.</span></span><br><span class="line"><span class="string">Remove anonymous users? [Y/n] y</span></span><br><span class="line"><span class="string">... Success!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Normally, root should only be allowed to connect from '</span>localhost<span class="string">'.  This</span></span><br><span class="line"><span class="string">ensures that someone cannot guess at the root password from the network.</span></span><br><span class="line"><span class="string">Disallow root login remotely? [Y/n] y</span></span><br><span class="line"><span class="string">... Success!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">By default, MariaDB comes with a database named '</span><span class="built_in">test</span><span class="string">' that anyone can</span></span><br><span class="line"><span class="string">access.  This is also intended only for testing, and should be removed</span></span><br><span class="line"><span class="string">before moving into a production environment.</span></span><br><span class="line"><span class="string">Remove test database and access to it? [Y/n] y</span></span><br><span class="line"><span class="string">\- Dropping test database...</span></span><br><span class="line"><span class="string">... Success!</span></span><br><span class="line"><span class="string">\- Removing privileges on test database...</span></span><br><span class="line"><span class="string">... Success!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Reloading the privilege tables will ensure that all changes made so far</span></span><br><span class="line"><span class="string">will take effect immediately.</span></span><br><span class="line"><span class="string">Reload privilege tables now? [Y/n] y</span></span><br><span class="line"><span class="string">... Success!</span></span><br><span class="line"><span class="string">Cleaning up...</span></span><br><span class="line"><span class="string">All done!  If you'</span>ve completed all of the above steps, your MariaDB</span><br><span class="line">installation should now be secure.</span><br><span class="line">Thanks <span class="keyword">for</span> using MariaDB!</span><br></pre></td></tr></table></figure></p>
<p>登录数据库<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># mysql -u root -</span></span><br><span class="line">Enter password:</span><br></pre></td></tr></table></figure></p>
<p>数据库的一些基础命令(！注：任何命令都需要以分号结尾)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; <span class="built_in">set</span> password =password=(<span class="string">'123'</span>);  <span class="comment">#修改当前用户的密码</span></span><br><span class="line">MariaDB [(none)]&gt; create user <span class="built_in">test</span>@localhost identified by <span class="string">'123'</span>;  <span class="comment">#创建一个名为test的用户并给其设置密码</span></span><br><span class="line">MariaDB [(none)]&gt; grant select,update on mysql.user to <span class="built_in">test</span>@localhost;  <span class="comment">#赋予查询和修改权限给test用户</span></span><br><span class="line">MariaDB [(none)]&gt; revoke select,update on mysql.user from <span class="built_in">test</span>@localhost;  <span class="comment">#移除test用户的查询和修改权限</span></span><br><span class="line">MariaDB [(none)]&gt; show databases;    <span class="comment">#查看所有数据库</span></span><br><span class="line">MariaDB [(none)]&gt; create database <span class="built_in">test</span>; <span class="comment">#创建名为test的数据库</span></span><br><span class="line">MariaDB [(none)]&gt; use <span class="built_in">test</span>;  <span class="comment">#切换数据库</span></span><br><span class="line">MariaDB [<span class="built_in">test</span>]&gt; show tables;  <span class="comment">#查看test数据库中的所有表</span></span><br><span class="line">MariaDB [<span class="built_in">test</span>]&gt; create table student(id varchar(20),name varchar(20)); <span class="comment">#创建一张名为student的表并给表添加两个表项</span></span><br><span class="line">MariaDB [<span class="built_in">test</span>]&gt; desc student;  <span class="comment">#查看student表的表项</span></span><br><span class="line">MariaDB [<span class="built_in">test</span>]&gt; insert into student values(<span class="string">"1002"</span>,<span class="string">"xiaoming"</span>);  给表插入数据</span><br><span class="line">MariaDB [<span class="built_in">test</span>]&gt; select * from student;  <span class="comment">#查看表中的数据</span></span><br><span class="line">MariaDB [<span class="built_in">test</span>]&gt; select id from student <span class="built_in">where</span> name=<span class="string">"xiaoming"</span>;  <span class="comment">#有条件的对表进行查询</span></span><br><span class="line">MariaDB [<span class="built_in">test</span>]&gt; alter table student modify column name varchar(10);  <span class="comment">#修改表项的长度</span></span><br><span class="line">MariaDB [<span class="built_in">test</span>]&gt; update student <span class="built_in">set</span> name=<span class="string">'xiaozhang'</span> <span class="built_in">where</span> id=<span class="string">'1001'</span>;  <span class="comment">#修改表中id为‘1001’的name值</span></span><br><span class="line">MariaDB [<span class="built_in">test</span>]&gt; delete from student <span class="built_in">where</span> id=<span class="string">'1001'</span>;  <span class="comment">#删除表中1001的数据</span></span><br><span class="line">MariaDB [<span class="built_in">test</span>]&gt; drop table student;  <span class="comment">#删除表</span></span><br><span class="line">MariaDB [mysql]&gt; drop database <span class="built_in">test</span>;  <span class="comment">#删除test数据库</span></span><br><span class="line">MariaDB [mysql]&gt; show variables like <span class="string">'%char%'</span>;  <span class="comment">#查看数据库字符集</span></span><br><span class="line">MariaDB [mysql]&gt; show engines; <span class="comment">#查看数据库存储引擎</span></span><br><span class="line">MariaDB [mysql]&gt; show variables like <span class="string">"%storage_engine%"</span>;  <span class="comment">#查看数据库默认的存储引擎</span></span><br></pre></td></tr></table></figure></p>
<h4 id="数据库的备份和恢复"><a href="#数据库的备份和恢复" class="headerlink" title="数据库的备份和恢复"></a>数据库的备份和恢复</h4><p>mysqldump命令用于备份数据库数据，格式为”mysqldump [参数] [数据库名称]”其中参数与mysql命令大致相同，-u 参数用于定义登录数据库的账户名称，-p参数代表密码提示符<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># mysqldump -u root -p test  &gt; /root/root.dump  #备份root用户中test数据库并命名为test.dump</span></span><br></pre></td></tr></table></figure></p>
<p>导入数据库<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; create database <span class="built_in">test</span>;  <span class="comment">#先创建一个空的数据库</span></span><br><span class="line">[root@server ~]<span class="comment"># mysql -u root -p test &lt; /root/root.dump  #再将其导入</span></span><br></pre></td></tr></table></figure></p>
<h4 id="MySQL数据库字符集设置-有两种方法"><a href="#MySQL数据库字符集设置-有两种方法" class="headerlink" title="MySQL数据库字符集设置(有两种方法)"></a>MySQL数据库字符集设置(有两种方法)</h4><p>1、编辑/etc/my.cnf配置为文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># vim /etc/my.cnf.d/client.cnf</span></span><br><span class="line">[client]</span><br><span class="line">default-character-set=utf8</span><br><span class="line">[root@server ~]<span class="comment"># vim /etc/my.cnf.d/server.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line">character-set-server=utf8</span><br><span class="line">[root@server ~]<span class="comment"># vim /etc/my.cnf.d/mysql-clients.cnf</span></span><br><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8</span><br><span class="line">MariaDB [(none)]&gt; show variables like <span class="string">"%char%"</span>;  <span class="comment">#查看结果</span></span><br><span class="line">+--------------------------+----------------------------+</span><br><span class="line">| Variable_name            | Value                      |</span><br><span class="line">+--------------------------+----------------------------+</span><br><span class="line">| character_set_client     | utf8                       |</span><br><span class="line">| character_set_connection | utf8                       |</span><br><span class="line">| character_set_database   | utf8                       |</span><br><span class="line">| character_set_filesystem | binary                     |</span><br><span class="line">| character_set_results    | utf8                       |</span><br><span class="line">| character_set_server     | utf8                       |</span><br><span class="line">| character_set_system     | utf8                       |</span><br><span class="line">| character_sets_dir       | /usr/share/mysql/charsets/ |</span><br><span class="line">+--------------------------+----------------------------+</span><br><span class="line">8 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p>2、直接使用命令修改<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; <span class="built_in">set</span> character_set_client=utf8;</span><br><span class="line">MariaDB [(none)]&gt; <span class="built_in">set</span> character_set_results=utf8;</span><br><span class="line">MariaDB [(none)]&gt; <span class="built_in">set</span> character_set_connection=utf8;</span><br><span class="line">MariaDB [(none)]&gt; show variables like <span class="string">"%char%"</span>;  <span class="comment">#查看结果</span></span><br></pre></td></tr></table></figure></p>
<p>mysql密码破解<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># systemctl stop mariadb.service  #关闭mysql服务</span></span><br><span class="line">[root@server ~]<span class="comment"># /usr/bin/mysqld_safe --user=mysql --skip-grant-table &amp;  #使mysql服务跳过权限方式启动</span></span><br><span class="line">[1] 18580</span><br><span class="line">[root@server ~]<span class="comment"># 190324 19:55:24 mysqld_safe Logging to '/var/log/mariadb/mariadb.log'.</span></span><br><span class="line">190324 19:55:24 mysqld_safe Starting mysqld daemon with databases from /var/lib/mysql</span><br><span class="line">[root@server ~]<span class="comment"># mysql  #直接敲mysql进入数据库</span></span><br><span class="line">MariaDB [(none)]&gt; use mysql  <span class="comment">#mysql用户和密码认证信息都存放在mysql库中的user表</span></span><br><span class="line">MariaDB [mysql]&gt; update user <span class="built_in">set</span> password=password(<span class="string">'123'</span>) <span class="built_in">where</span> user=<span class="string">'root'</span>; <span class="comment">#只需要修改mysql相应的密码表项数据即可</span></span><br><span class="line">MariaDB [mysql]&gt;flush privileges;  <span class="comment">#刷新权限缓存</span></span><br><span class="line">[root@server ~]<span class="comment"># systemctl restart mariadb.service</span></span><br></pre></td></tr></table></figure></p>
<h4 id="索引："><a href="#索引：" class="headerlink" title="索引："></a>索引：</h4><p>mysql索引可以用来快速的寻找某些特定值得记录，所有mysql索引都以B+树的形式保存<br>类型：<br>普通索引(normal)：使用最广泛的索引<br>唯一索引(unique)：不允许重复的索引，允许有空值<br>全文索引(full text)：只能用于MyISAM表，主要是用于大量的内容检索<br>主键索引(primary key)：又称为特殊的唯一索引，不允许有空值<br>组合索引：可提高mysql效率<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [<span class="built_in">test</span>]&gt; alter table student add primary key (id);  <span class="comment">#创建主键索引</span></span><br><span class="line">MariaDB [<span class="built_in">test</span>]&gt; alter table student add unique(id);  <span class="comment">#创建唯一索引</span></span><br><span class="line">MariaDB [<span class="built_in">test</span>]&gt; alter table student add index index_name(id);  <span class="comment">#创建普通索引，index_name 为索引名，下同</span></span><br><span class="line">MariaDB [<span class="built_in">test</span>]&gt; alter table student add fulltext(id);  <span class="comment">#创建全文索引</span></span><br><span class="line">MariaDB [<span class="built_in">test</span>]&gt; alter table student add index index_name(id,name);  <span class="comment">#创建组合索引</span></span><br></pre></td></tr></table></figure></p>
<p>删除索引<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [<span class="built_in">test</span>]&gt; alter table student drop primary key;  <span class="comment">#后加索引类型</span></span><br><span class="line">MariaDB [<span class="built_in">test</span>]&gt; alter table student drop index_name;  <span class="comment">#或加索引名</span></span><br></pre></td></tr></table></figure></p>
<p>查看索引<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [<span class="built_in">test</span>]&gt; show keys from student;   <span class="comment">#查看主键索引</span></span><br><span class="line">MariaDB [<span class="built_in">test</span>]&gt; show index from student;   <span class="comment">#查看所有索引</span></span><br></pre></td></tr></table></figure></p>
<h4 id="mysql慢查询"><a href="#mysql慢查询" class="headerlink" title="mysql慢查询"></a>mysql慢查询</h4><p>慢查询主要用于跟踪异常的sql语句，慢查询日志则是用来记录在mysql中响应时间超过阀值的语句，具体指运行时间超过long _query_time 值得语句，会被记录到慢查询日志当中<br>mysql默认不开启慢查询日志功能<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [<span class="built_in">test</span>]&gt; show variables like <span class="string">"%slow%"</span>;  <span class="comment">#查看慢查询日志是否开启</span></span><br><span class="line">MariaDB [<span class="built_in">test</span>]&gt; show variables like <span class="string">"%long_query%"</span>;  <span class="comment">#查看超时时间，默认为10s</span></span><br></pre></td></tr></table></figure></p>
<h3 id="慢查询的参数："><a href="#慢查询的参数：" class="headerlink" title="慢查询的参数："></a>慢查询的参数：</h3><p>1、log_slow_queries：慢查询日志功能<br>2、long_query_time：慢查询超时时间，默认为十秒，mysql5.5以上可以设置微秒<br>3、slow_query_log：慢查询日志<br>4、slow_query_log_file：慢查询日志文件<br>5、slow_launch_time：thread create时间，单位为秒，如果create时间超过超过这个值，该变量的值就会加1<br>6、log-queries-not-using-indexes：记录未添加索引的sql语句</p>
<h4 id="开启mysql慢查询日志的方法有两种："><a href="#开启mysql慢查询日志的方法有两种：" class="headerlink" title="开启mysql慢查询日志的方法有两种："></a>开启mysql慢查询日志的方法有两种：</h4><p>修改配置文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># vim /etc/my.cnf</span></span><br><span class="line"><span class="built_in">log</span>-slow-queries = /data/mysql/localhost.log</span><br><span class="line">long_query_time = 0.01</span><br><span class="line">long-queries-not-using-indexes</span><br><span class="line">[root@server ~]<span class="comment"># systemctl restart mariadb.service</span></span><br></pre></td></tr></table></figure></p>
<p>在数据库中执行命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; <span class="built_in">set</span> global slow_query_log=on;</span><br><span class="line">MariaDB [(none)]&gt; show variables like <span class="string">"%slow%"</span>;</span><br></pre></td></tr></table></figure></p>
</div><div class="post-copyright"><div class="post-copyright-author"><span class="post-copyright-meta">本文作者: </span><span class="post-copyright-info"><a href="mailto:undefined">小白long</a></span></div><div class="post-copyright-type"><span class="post-copyright-meta">本文链接: </span><span class="post-copyright-info"><a href="https://mmxlong.github.io/2019/04/20/MariaDB数据库管理系统/">https://mmxlong.github.io/2019/04/20/MariaDB数据库管理系统/</a></span></div><div class="post-copyright-notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://mmxlong.github.io">藏经阁</a>！</span></div></div></article><div id="pagination"><div class="prev-post pull-left"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/2019/04/20/phpMyadmin管理mysql/"><i class="fas fa-angle-left">&nbsp;</i><span>phpMyadmin管理mysql</span></a></div><div class="next-post pull-right"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/2019/04/20/搭建discuz论坛/"><span>搭建discuz论坛</span><span>&nbsp;</span><i class="fas fa-angle-right"></i></a></div></div><!--div!= paginator()--></div></div><div class="button-hover" id="return-top"><i class="fas fa-arrow-up" aria-hidden="true"></i></div><footer><div id="footer"><div class="button-hover" id="side-button"><i class="fas fa-arrow-right"></i></div><div class="right-content"><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fas fa-file-o"></i></span><span id="busuanzi_value_page_pv"></span><span></span></div><div class="copyright">&copy;2017 ～ 2019 By 小白long</div></div></div></footer></div><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery-3.3.1.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/velocity.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery.mCustomScrollbar.concat.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/fan.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/canvas_bg.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/utils.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/scroll.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/sidebar.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/copy.js"></script><!--script(src=url)--></body></html>