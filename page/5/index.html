<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content><meta name="keywords" content><meta name="author" content="小白long,undefined"><meta name="copyright" content="小白long"><title>【藏经阁】</title><link rel="stylesheet" href="/css/fan.css"><link rel="stylesheet" href="/css/thirdparty/jquery.mCustomScrollbar.min.css"><link rel="icon" href="/favicon.ico"><script>var isPassword = '' || false;
if (isPassword) {
    if (prompt('请输入文章密码') !== '') {
        alert('密码错误！');
        history.back();
    }
}</script><script>window.GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
}</script></head><body><canvas id="universe"></canvas><!--#body--><div id="sidebar"><div class="author-info"><div class="author-info-avatar"><img class="author-info-avatar-img" src="/avatar.png"></div><div class="author-info-name">小白long</div><div class="author-info-description"></div><div class="links-buttons"><a class="links-button button-hover" href="https://github.com/mmxlong/mmxlong.github.io" target="_blank">GitHub<i class="icon-dot bg-color1"></i></a><a class="links-button button-hover" href="mailto:1835872473@qq.com" target="_blank">E-Mail<i class="icon-dot bg-color6"></i></a><a class="links-button button-hover" href="tencent://message/?uin=1019593584&amp;Site=&amp;Menu=yes" target="_blank">QQ<i class="icon-dot bg-color6"></i></a></div><div class="author-info-articles"><a class="author-info-articles-archives article-meta" href="/archives"><span class="pull-top">日志</span><span class="pull-bottom">23</span></a><a class="author-info-articles-tags article-meta" href="/tags"><span class="pull-top">标签</span><span class="pull-bottom">15</span></a><a class="author-info-articles-categories article-meta" href="/categories"><span class="pull-top">分类</span><span class="pull-bottom">1</span></a></div></div></div><div id="main-container"><header><div id="menu-outer"><i class="menu-list-icon fas fa-bars"></i><nav id="menu-inner"><a class="menu-item" href="/">首页</a><a class="menu-item" href="/tags">标签</a><a class="menu-item" href="/categories">分类</a><a class="menu-item" href="/archives">归档</a><a class="menu-item" href="/about">关于</a></nav><div class="right-info"><a class="title-name" href="/">藏经阁</a><span id="now-time"></span></div></div></header><div id="content-outer"><div id="content-inner"><div id="recent-posts"><!-- each post in page.posts.sort('date', -1).limit(10).toArray()--><!-- config中配置按照什么排序--><div class="recent-post-item"><a class="post-title" href="/2019/04/20/Samba服务/">Samba服务</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2019-04-20</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/Linux服务部署/">Linux服务部署</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/Linux/">Linux</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/Samba/">Samba</a></div></div><div class="post-content"><div class="main-content content"><h3 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h3><p>两台主机：一台server，一台client</p>
<h3 id="实验步骤"><a href="#实验步骤" class="headerlink" title="实验步骤"></a>实验步骤</h3><h4 id="server端"><a href="#server端" class="headerlink" title="server端"></a>server端</h4><p>安装相关软件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># yum install -y samba</span></span><br></pre></td></tr></table></figure></p>
<p>备份samba配置文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># cp -a /etc/samba/smb.conf /etc/samba/smb.conf_bak</span></span><br></pre></td></tr></table></figure></p>
<p>修改配置文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># vim /etc/samba/smb.conf</span></span><br><span class="line">[database]  <span class="comment">#共享名称</span></span><br><span class="line">        comment=this is a samba server  <span class="comment">#为访问用户的提醒</span></span><br><span class="line">        path=/var/sambatest    <span class="comment">#共享目录</span></span><br><span class="line">        public=no    <span class="comment">#关闭所有人可见</span></span><br><span class="line">        writable=yes    <span class="comment">#准许写入</span></span><br></pre></td></tr></table></figure></p>
<p>创建共享目录<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># mkdir /var/sambatest</span></span><br></pre></td></tr></table></figure></p>
<p>创建访问共享用户(不是本地系统登录用户)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># useradd sambatest    #先创建本地用户</span></span><br><span class="line">[root@server ~]<span class="comment"># pdbedit -a -u sambatest #在创建共享使用的用户</span></span><br><span class="line">new password:</span><br><span class="line">retype new password:</span><br><span class="line">Unix username:        sambatest</span><br></pre></td></tr></table></figure></p>
<p>创建共享目录并赋予权限<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># mkdir /var/sambatest</span></span><br><span class="line">[root@server ~]<span class="comment"># chown -Rf sambatest:sambatest /var/sambatest/</span></span><br></pre></td></tr></table></figure></p>
<p>安装semanage工具并给目录进行配置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># yum install -y policycoreutils-python.x86_64 </span></span><br><span class="line">[root@server ~]<span class="comment"># semanage fcontext -a -t samba_share_t /var/sambatest</span></span><br><span class="line">[root@server ~]<span class="comment"># restorecon -Rv /var/sambatest/</span></span><br><span class="line">restorecon reset /var/sambatest context unconfined_u:object_r:var_t:s0-&gt;unconfined_u:object_r:samba_share_t:s0</span><br></pre></td></tr></table></figure></p>
<p>启动samba服务，配置防火墙规则<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># systemctl start smb</span></span><br><span class="line">[root@server ~]<span class="comment"># systemctl enable smb</span></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/smb.service to /usr/lib/systemd/system/smb.service.</span><br><span class="line">[root@server ~]<span class="comment"># firewall-cmd --add-service=samba</span></span><br><span class="line">samba         samba-client  </span><br><span class="line">[root@server ~]<span class="comment"># firewall-cmd --add-service=samba --permanent</span></span><br><span class="line">success</span><br><span class="line">[root@server ~]<span class="comment"># firewall-cmd --reload</span></span><br><span class="line">success</span><br></pre></td></tr></table></figure></p>
<h4 id="client端"><a href="#client端" class="headerlink" title="client端"></a>client端</h4><p>安装软件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@client ~]<span class="comment"># yum install -y samba-client cifs-utils</span></span><br></pre></td></tr></table></figure></p>
<p>访问samba共享<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@client ~]<span class="comment"># smbclient //192.168.42.11/database -U sambatest</span></span><br><span class="line">Enter SAMBA\sambatest<span class="string">'s password:</span></span><br><span class="line"><span class="string">Try "help" to get a list of possible commands.</span></span><br><span class="line"><span class="string">smb: \&gt; ls</span></span><br><span class="line"><span class="string">  .                                   D        0  Wed Mar 20 10:21:01 2019</span></span><br><span class="line"><span class="string">  ..                                  D        0  Wed Mar 20 10:21:01 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        17811456 blocks of size 1024. 16490916 blocks available</span></span><br><span class="line"><span class="string">smb: \&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>挂载命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@client ~]<span class="comment"># mount -t cifs //192.168.42.11/database /home/test/ -o username=sambatest</span></span><br><span class="line">Password <span class="keyword">for</span> sambatest@//192.168.42.11/database:  *</span><br></pre></td></tr></table></figure></p>
<p>配置开机挂载<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@client home]<span class="comment"># vim /etc/auth.smb</span></span><br><span class="line">username=sambatest</span><br><span class="line">password=1</span><br><span class="line">[root@client home]<span class="comment"># vim /etc/fstab</span></span><br><span class="line">//192.168.42.11/database        /home/<span class="built_in">test</span>      cifs    credentials=/etc/auth.smb       0 0</span><br><span class="line">[root@client ~]<span class="comment"># mount -a</span></span><br><span class="line">[root@client ~]<span class="comment"># df -h</span></span><br><span class="line">Filesystem                Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/centos-root    17G  1.3G   16G   8% /</span><br><span class="line">devtmpfs                  475M     0  475M   0% /dev</span><br><span class="line">tmpfs                     487M     0  487M   0% /dev/shm</span><br><span class="line">tmpfs                     487M  7.6M  479M   2% /run</span><br><span class="line">tmpfs                     487M     0  487M   0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1                1014M  133M  882M  14% /boot</span><br><span class="line">tmpfs                      98M     0   98M   0% /run/user/0</span><br><span class="line">//192.168.42.11/database   17G  1.3G   16G   8% /home/<span class="built_in">test</span></span><br></pre></td></tr></table></figure></p>
<p>windows上测试<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">\\192.168.42.11</span><br><span class="line"><span class="comment">#输入用户和密码</span></span><br></pre></td></tr></table></figure></p>
</div></div><a class="button-hover more" href="/2019/04/20/Samba服务/#more">阅读全文</a></div><div class="recent-post-item"><a class="post-title" href="/2019/04/20/vsftp服务配置虚拟用户/">vsftp服务配置虚拟用户</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2019-04-20</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/Linux服务部署/">Linux服务部署</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/Linux/">Linux</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/vsftp/">vsftp</a></div></div><div class="post-content"><div class="main-content content"><h3 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h3><pre><code>两台主机：一台server，一台client
</code></pre><h3 id="实验步骤"><a href="#实验步骤" class="headerlink" title="实验步骤"></a>实验步骤</h3><p>安装相应软件包<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># yum install -y vsftpd</span></span><br></pre></td></tr></table></figure></p>
<p>将配置文件备份和去除注释<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># mv /etc/vsftpd/vsftpd.conf&#123;,_bak&#125;</span></span><br><span class="line">[root@server ~]<span class="comment"># grep -v "#" /etc/vsftpd/vsftpd.conf_bak &gt; /etc/vsftpd/vsftpd.conf</span></span><br></pre></td></tr></table></figure></p>
<h4 id="配置匿名开放模式"><a href="#配置匿名开放模式" class="headerlink" title="配置匿名开放模式"></a>配置匿名开放模式</h4><pre><code>修改配置文件和赋予权限、重启服务
</code></pre><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># vim /etc/vsftpd/vsftpd.conf</span></span><br><span class="line">anonymous_enable=YES</span><br><span class="line">anon_upload_enable=YES  <span class="comment">#添加可上传文件权限，若想添加其他也可</span></span><br><span class="line"><span class="comment">#anon_mkdir_write_enable=YES</span></span><br><span class="line"><span class="comment">#anon_other_write_enable=YES</span></span><br><span class="line">local_enable=YES</span><br><span class="line">write_enable=YES</span><br><span class="line">local_umask=022</span><br><span class="line">dirmessage_enable=YES</span><br><span class="line">xferlog_enable=YES</span><br><span class="line">connect_from_port_20=YES</span><br><span class="line">xferlog_std_format=YES</span><br><span class="line">listen=NO</span><br><span class="line">listen_ipv6=YES</span><br><span class="line">pam_service_name=vsftpd</span><br><span class="line">userlist_enable=YES</span><br><span class="line">tcp_wrappers=YES</span><br><span class="line">[root@server ~]<span class="comment"># systemctl restart vsftpd</span></span><br><span class="line">[root@server ~]<span class="comment"># systemctl enable vsftpd</span></span><br><span class="line">[root@server ~]<span class="comment"># firewall-cmd --add-service=ftp --permanent</span></span><br><span class="line">success</span><br><span class="line">[root@server ~]<span class="comment"># firewall-cmd --reload</span></span><br><span class="line">success</span><br><span class="line">[root@server ~]<span class="comment"># chown -Rf ftp /var/ftp/pub/</span></span><br><span class="line">[root@server ftp]<span class="comment"># setsebool -P ftpd_full_access=on</span></span><br></pre></td></tr></table></figure>
<h4 id="配置本地用户模式"><a href="#配置本地用户模式" class="headerlink" title="配置本地用户模式"></a>配置本地用户模式</h4><pre><code>修改配置文件
</code></pre><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@server ftp]<span class="comment"># vim /etc/vsftpd/vsftpd.conf</span></span><br><span class="line">anonymous_enable=NO  <span class="comment">#将匿名用户no掉即可</span></span><br><span class="line">local_enable=YES</span><br><span class="line">write_enable=YES</span><br><span class="line">local_umask=022</span><br><span class="line">dirmessage_enable=YES</span><br><span class="line">xferlog_enable=YES</span><br><span class="line">connect_from_port_20=YES</span><br><span class="line">xferlog_std_format=YES</span><br><span class="line">listen_ipv6=YES</span><br><span class="line">listen=NO</span><br><span class="line">pam_service_name=vsftpd</span><br><span class="line">userlist_enable=YES</span><br><span class="line">tcp_wrappers=YES</span><br></pre></td></tr></table></figure>
<p>开启服务和开启启动<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server ftp]<span class="comment"># systemctl restart vsftpd</span></span><br><span class="line">[root@server ~]<span class="comment"># systemctl enable vsftpd</span></span><br></pre></td></tr></table></figure></p>
<p>测试：随便创建一个用户即可</p>
<h4 id="配置虚拟用户模式"><a href="#配置虚拟用户模式" class="headerlink" title="配置虚拟用户模式"></a>配置虚拟用户模式</h4><p>创建一个本地不可登陆服务器用户<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server ftp]<span class="comment"># useradd -d /var/ftptest -s /sbin/nologin long</span></span><br></pre></td></tr></table></figure></p>
<p>创建用户进行ftp认证的用户数据库文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@server ftp]<span class="comment"># cd /etc/vsftpd/</span></span><br><span class="line">[root@server vsftpd]<span class="comment"># vim vuser.list</span></span><br><span class="line">long</span><br><span class="line">1234</span><br></pre></td></tr></table></figure></p>
<p>使用db_load命令用哈希(hash)算法将原始的明文信息文件转换成数据库文件的权限(避免其他人看到数据库文件的内容)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server vsftpd]<span class="comment"># db_load -T -t hash -f vuser.list vuser.db</span></span><br></pre></td></tr></table></figure></p>
<p>配置内核的vsftp用户认证模块<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@server vsftpd]<span class="comment"># vim /etc/pam.d/vsftpd.vu</span></span><br><span class="line">auth    required    pam_userdb.so    db=/etc/vsftpd/vuser</span><br><span class="line">account    required    pam_userdb.so    db=/etc/vsftpd/vuser</span><br></pre></td></tr></table></figure></p>
<p>配置虚拟用户的权限<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@server vsftpd]<span class="comment"># vim vusers_dir/long</span></span><br><span class="line">anon_upload_enable=YES</span><br><span class="line">local_root=/var/ftptest <span class="comment">#设置虚拟用户访问的家目录</span></span><br></pre></td></tr></table></figure></p>
<p>配置虚拟用户只能访问他自己家目录限制的文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># vim /etc/vsftpd/chroot_list</span></span><br><span class="line">long</span><br></pre></td></tr></table></figure></p>
<p>配置vsftp的主配置文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">anonymous_enable=NO</span><br><span class="line">local_enable=YES</span><br><span class="line">write_enable=YES</span><br><span class="line">guest_enable=YES</span><br><span class="line">guest_username=long</span><br><span class="line">allow_writeable_chroot=YES</span><br><span class="line">chroot_local_user=NO   <span class="comment">#所有用户不被限制在主目录中</span></span><br><span class="line">chroot_list_enable=YES    <span class="comment">#启用限制用户文件</span></span><br><span class="line">chroot_list_file=/etc/vsftpd/chroot_list <span class="comment">#所被限制用户所在文件，且文件中的用户只能访问它们的家目录</span></span><br><span class="line">local_umask=022</span><br><span class="line">dirmessage_enable=YES</span><br><span class="line">xferlog_enable=YES</span><br><span class="line">connect_from_port_20=YES</span><br><span class="line">xferlog_std_format=YES</span><br><span class="line">listen_ipv6=YES</span><br><span class="line">listen=NO</span><br><span class="line">pam_service_name=vsftpd.vu</span><br><span class="line">userlist_enable=YES</span><br><span class="line">tcp_wrappers=YES</span><br><span class="line">user_config_dir=/etc/vsftpd/vusers_dir</span><br></pre></td></tr></table></figure></p>
<p>重启服务并设置seLinux规则<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># systemctl restart vsftpd</span></span><br><span class="line">[root@server ~]<span class="comment"># systemctl enable vsftpd</span></span><br><span class="line">[root@server ~]<span class="comment"># firewall-cmd --add-service=ftp --permanent</span></span><br><span class="line">success</span><br><span class="line">[root@server ~]<span class="comment"># firewall-cmd --reload</span></span><br><span class="line">success</span><br><span class="line">[root@server ~]<span class="comment"># setsebool -P ftpd_full_access=on</span></span><br></pre></td></tr></table></figure></p>
</div></div><a class="button-hover more" href="/2019/04/20/vsftp服务配置虚拟用户/#more">阅读全文</a></div><div class="recent-post-item"><a class="post-title" href="/2019/04/20/NFS服务/">NFS服务</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2019-04-20</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/Linux服务部署/">Linux服务部署</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/Linux/">Linux</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/NFS/">NFS</a></div></div><div class="post-content"><div class="main-content content"><p>NFS（网络文件系统）</p>
<h3 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h3><p>Server设置/root/remotefs为共享目录让Client能同步到这个目录<br>Server（ip 172.25.1.128）：</p>
<h3 id="实验步骤"><a href="#实验步骤" class="headerlink" title="实验步骤"></a>实验步骤</h3><h4 id="server端"><a href="#server端" class="headerlink" title="server端"></a>server端</h4><p>安装相关软件包、开启服务以及声明要挂载的文件夹<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum install rpcbind nfs-utils</span></span><br><span class="line"><span class="comment"># systemctl enable &#123;rpcbind,nfs-utils&#125;</span></span><br><span class="line"><span class="comment"># systemctl start &#123;rpcbind,nfs-utils&#125;</span></span><br><span class="line"><span class="comment"># vim /etc/exports</span></span><br><span class="line">/root/remotefs  *(rw)</span><br></pre></td></tr></table></figure></p>
<p>保存退出<br>防火墙放行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># firewall-cmd --add-service=rpc-bind</span></span><br><span class="line">success</span><br><span class="line">[root@localhost ~]<span class="comment"># firewall-cmd --add-port=20048/tcp</span></span><br><span class="line">success</span><br><span class="line">[root@localhost ~]<span class="comment"># firewall-cmd --add-service=nfs</span></span><br><span class="line">success</span><br><span class="line">[root@localhost ~]firewall-cmd runtime-to-permanent</span><br></pre></td></tr></table></figure></p>
<h4 id="Client端"><a href="#Client端" class="headerlink" title="Client端"></a>Client端</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum install nfs-utils</span></span><br></pre></td></tr></table></figure>
<p>用showmount -e命令探测远程挂载<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># showmount -e 172.25.1.128</span></span><br><span class="line">Export list <span class="keyword">for</span> 172.25.1.128:/root/remotefs *</span><br></pre></td></tr></table></figure></p>
<p>我们可以从列表中选择一个去挂载到本地的某个目录<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkdir /remote</span></span><br><span class="line"><span class="comment"># mount -t nfs 172.25.1.128:/root/remotefs /remote</span></span><br></pre></td></tr></table></figure></p>
<p>一般做为开机挂载使用<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/fstab</span></span><br><span class="line">172.25.1.128:/root/remotefs     /remote nfs     defaults        0 0</span><br></pre></td></tr></table></figure></p>
<p>保存退出<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mount -a</span></span><br></pre></td></tr></table></figure></p>
<p>再敲mount -a检查是否挂载成功</p>
</div></div><a class="button-hover more" href="/2019/04/20/NFS服务/#more">阅读全文</a></div><div class="recent-post-item"><a class="post-title" href="/2019/04/20/DHCP服务/">DHCP服务</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2019-04-20</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/Linux服务部署/">Linux服务部署</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/Linux/">Linux</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/DHCP/">DHCP</a></div></div><div class="post-content"><div class="main-content content"><h3 id="dhcp参数："><a href="#dhcp参数：" class="headerlink" title="dhcp参数："></a>dhcp参数：</h3><h4 id="parameters参数：-表明如何执行任务，是否要执行任务，或将哪些网络配置选项发送给客户"><a href="#parameters参数：-表明如何执行任务，是否要执行任务，或将哪些网络配置选项发送给客户" class="headerlink" title="parameters参数： 表明如何执行任务，是否要执行任务，或将哪些网络配置选项发送给客户"></a>parameters参数： 表明如何执行任务，是否要执行任务，或将哪些网络配置选项发送给客户</h4><table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">default-lease-time</td>
<td style="text-align:center">指定默认租赁时间的长度，单位是秒</td>
</tr>
<tr>
<td style="text-align:center">max-lease-time</td>
<td style="text-align:center">指定最大租赁时间长度，单位是秒</td>
</tr>
<tr>
<td style="text-align:center">hardware</td>
<td style="text-align:center">指定网卡接口类型和MAC地址</td>
</tr>
<tr>
<td style="text-align:center">ddns-update-style</td>
<td style="text-align:center">配置DHCP-DNS 互动更新模式</td>
</tr>
<tr>
<td style="text-align:center">server-name</td>
<td style="text-align:center">通知DHCP客户服务器名称</td>
</tr>
<tr>
<td style="text-align:center">get-lease-hostnames flag</td>
<td style="text-align:center">检查客户端使用的IP地址</td>
</tr>
<tr>
<td style="text-align:center">fixed-address ip</td>
<td style="text-align:center">分配给客户端一个固定的地址</td>
</tr>
<tr>
<td style="text-align:center">authritative</td>
<td style="text-align:center">拒绝不正确的IP地址的要求</td>
</tr>
</tbody>
</table>
<h4 id="declarations：用来描述网络布局、提供客户的IP地址等"><a href="#declarations：用来描述网络布局、提供客户的IP地址等" class="headerlink" title="declarations：用来描述网络布局、提供客户的IP地址等"></a>declarations：用来描述网络布局、提供客户的IP地址等</h4><table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">shared-network</td>
<td style="text-align:center">用来告知是否一些子网络分享相同网络</td>
</tr>
<tr>
<td style="text-align:center">subnet</td>
<td style="text-align:center">描述一个IP地址是否属于该子网</td>
</tr>
<tr>
<td style="text-align:center">range 起始IP 终止IP</td>
<td style="text-align:center">提供动态分配IP 的范围</td>
</tr>
<tr>
<td style="text-align:center">host 主机名称</td>
<td style="text-align:center">参考特别的主机</td>
</tr>
<tr>
<td style="text-align:center">group</td>
<td style="text-align:center">为一组参数提供声明</td>
</tr>
<tr>
<td style="text-align:center">allow unknown-clients;deny unknown-client</td>
<td style="text-align:center">是否动态分配IP给未知的使用者</td>
</tr>
<tr>
<td style="text-align:center">allow bootp;deny bootp</td>
<td style="text-align:center">是否响应激活查询</td>
</tr>
<tr>
<td style="text-align:center">allow booting;deny booting</td>
<td style="text-align:center">是否响应使用者查询</td>
</tr>
<tr>
<td style="text-align:center">filename</td>
<td style="text-align:center">开始启动文件的名称，应用于无盘工作站</td>
</tr>
</tbody>
</table>
<h4 id="option：用来配置DHCP可选参数，全部用option关键字作为开始"><a href="#option：用来配置DHCP可选参数，全部用option关键字作为开始" class="headerlink" title="option：用来配置DHCP可选参数，全部用option关键字作为开始"></a>option：用来配置DHCP可选参数，全部用option关键字作为开始</h4><table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">subnet-mask</td>
<td style="text-align:center">为客户端设定子网掩码</td>
</tr>
<tr>
<td style="text-align:center">domain-name</td>
<td style="text-align:center">为客户端指明DNS名字</td>
</tr>
<tr>
<td style="text-align:center">domain-name-servers</td>
<td style="text-align:center">为客户端指明DNS服务器IP地址</td>
</tr>
<tr>
<td style="text-align:center">host-name</td>
<td style="text-align:center">为客户端指定主机名称</td>
</tr>
<tr>
<td style="text-align:center">routers</td>
<td style="text-align:center">为客户端设定默认网关</td>
</tr>
<tr>
<td style="text-align:center">broadcast-address</td>
<td style="text-align:center">为客户端设定广播地址</td>
</tr>
<tr>
<td style="text-align:center">ntp-server</td>
<td style="text-align:center">为客户端设定网络时间服务器IP地址</td>
</tr>
<tr>
<td style="text-align:center">time－offset</td>
<td style="text-align:center">为客户端设定和格林威治时间的偏移时间，单位是秒</td>
</tr>
</tbody>
</table>
<h3 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h3><p>两台主机：一台server端，一台client端<br>server端需要有两张网卡：一张NAT模式，一张仅主机模式，client端网卡为仅主机模式</p>
<h3 id="实验步骤："><a href="#实验步骤：" class="headerlink" title="实验步骤："></a>实验步骤：</h3><h4 id="server端"><a href="#server端" class="headerlink" title="server端"></a>server端</h4><p>给新添加的网卡ens37配置静态ip<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># nmcli connection add con-name ens37 ifname ens37 type ethernet autoconnect yes  ipv4.method manual ipv4.address 192.168.88.254/24</span></span><br></pre></td></tr></table></figure></p>
<p>安装相关软件包<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># yum install -y dhcp</span></span><br></pre></td></tr></table></figure></p>
<p>修改dhcp配置文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># vim /etc/dhcp/dhcpd.conf</span></span><br><span class="line">ddns-update-style none;</span><br><span class="line">ignore client-updates;</span><br><span class="line">subnet 192.168.88.0 netmask 255.255.255.0&#123;</span><br><span class="line">        range 192.168.88.101 192.168.88.253;</span><br><span class="line">        option subnet-mask 255.255.255.0;</span><br><span class="line">        option routers 192.168.88.254;</span><br><span class="line">        option domain-name-servers 114.114.114.114,8.8.8.8;</span><br><span class="line">        default-lease-time 10000;</span><br><span class="line">        max-lease-time 30000;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>启动dhcp服务<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># systemctl restart dhcpd</span></span><br><span class="line">[root@server ~]<span class="comment"># systemctl enable dhcpd</span></span><br><span class="line">[root@server ~]<span class="comment"># firewall-cmd --add-service=dhcp</span></span><br><span class="line">success</span><br><span class="line">[root@server ~]<span class="comment"># firewall-cmd --add-service=dhcp --permanent</span></span><br><span class="line">success</span><br></pre></td></tr></table></figure></p>
<h4 id="client端"><a href="#client端" class="headerlink" title="client端"></a>client端</h4><p>设置成dhcp获取ip模式<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@client ~]<span class="comment"># systemctl restart network</span></span><br></pre></td></tr></table></figure></p>
<p>开启ip伪装和路由转发使客户端能上网<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># echo 1 &gt; /proc/sys/net/ipv4/ip_forward</span></span><br><span class="line">[root@server ~]<span class="comment"># firewall-cmd --add-masquerade --permanent</span></span><br><span class="line">success</span><br><span class="line">[root@server ~]<span class="comment"># firewall-cmd --add-masquerade</span></span><br><span class="line">success</span><br><span class="line">[root@server ~]<span class="comment"># sysctl -p</span></span><br></pre></td></tr></table></figure></p>
<p>开启NAT转换<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]<span class="comment"># firewall-cmd --direct --passthrough ipv4 -t nat -I POSTROUTING -o ens33 -j MASQUERADE -s 192.168.88.0/24</span></span><br><span class="line"><span class="comment">#firewall方式启用</span></span><br><span class="line">[root@server ~]<span class="comment"># iptables -t nat -A POSTROUTING  -s 192.168.88.0/24 -o ens33 -j SNAT --to-source 192.168.42.11</span></span><br><span class="line"><span class="comment">#iptables方式启用</span></span><br></pre></td></tr></table></figure></p>
</div></div><a class="button-hover more" href="/2019/04/20/DHCP服务/#more">阅读全文</a></div></div><div id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/4/"><i class="fas fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/6/"><i class="fas fa-angle-right"></i></a></div></div></div></div><div class="button-hover" id="return-top"><i class="fas fa-arrow-up" aria-hidden="true"></i></div><footer><div id="footer"><div class="button-hover" id="side-button"><i class="fas fa-arrow-right"></i></div><div class="right-content"><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fas fa-user"></i></span><span id="busuanzi_value_site_uv"></span><span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fas fa-eye"></i></span><span id="busuanzi_value_site_pv"></span><span></span></div><div class="copyright">&copy;2017 ～ 2019 By 小白long</div></div></div></footer></div><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery-3.3.1.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/velocity.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery.mCustomScrollbar.concat.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/fan.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/canvas_bg.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/utils.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/scroll.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/sidebar.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/copy.js"></script><!--script(src=url)--></body></html>